{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Workflow State Schema",
  "description": "Tracks execution state of the book design workflow for a specific project",
  "type": "object",
  "required": ["workflow_version", "project_name", "current_step", "last_updated", "steps"],
  "properties": {
    "workflow_version": {
      "type": "string",
      "description": "Version of the workflow being executed (from workflow_config.json)",
      "example": "1.0.0"
    },
    "project_name": {
      "type": "string",
      "description": "Name of the project this state tracks",
      "example": "dragon-mafia-paranormal-v1"
    },
    "current_step": {
      "type": ["string", "null"],
      "description": "The step that should run next. null means workflow is complete",
      "pattern": "^[0-9]+$",
      "example": "3"
    },
    "last_updated": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of last state update",
      "example": "2025-11-22T21:30:45Z"
    },
    "steps": {
      "type": "object",
      "description": "Status of each workflow step, keyed by step number",
      "patternProperties": {
        "^[0-9]+$": {
          "type": "object",
          "required": ["name", "status"],
          "properties": {
            "name": {
              "type": "string",
              "description": "Human-readable step name from workflow_config.json",
              "example": "NPE Extraction"
            },
            "status": {
              "type": "string",
              "enum": ["pending", "in_progress", "completed", "failed"],
              "description": "Current status of this step"
            },
            "started_at": {
              "type": "string",
              "format": "date-time",
              "description": "When this step started execution (ISO 8601)",
              "example": "2025-11-22T20:15:00Z"
            },
            "completed_at": {
              "type": "string",
              "format": "date-time",
              "description": "When this step completed successfully (ISO 8601)",
              "example": "2025-11-22T20:18:30Z"
            },
            "failed_at": {
              "type": "string",
              "format": "date-time",
              "description": "When this step failed (ISO 8601)",
              "example": "2025-11-22T20:18:30Z"
            },
            "error": {
              "type": "string",
              "description": "Error message if status is 'failed'",
              "example": "Missing required input file: input/story-concept.md"
            },
            "outputs_generated": {
              "type": "array",
              "description": "List of output files successfully created by this step",
              "items": {
                "type": "string"
              },
              "example": ["outputs/npe.md"]
            }
          }
        }
      }
    }
  },
  "example": {
    "workflow_version": "1.0.0",
    "project_name": "dragon-mafia-paranormal-v1",
    "current_step": "3",
    "last_updated": "2025-11-22T21:30:45Z",
    "steps": {
      "1": {
        "name": "NPE Extraction",
        "status": "completed",
        "started_at": "2025-11-22T20:15:00Z",
        "completed_at": "2025-11-22T20:18:30Z",
        "outputs_generated": ["outputs/npe.md"]
      },
      "2": {
        "name": "Dramatic Spine Extraction",
        "status": "completed",
        "started_at": "2025-11-22T20:19:00Z",
        "completed_at": "2025-11-22T20:22:15Z",
        "outputs_generated": ["outputs/dramatic_spine.md"]
      },
      "3": {
        "name": "Theme Extraction",
        "status": "in_progress",
        "started_at": "2025-11-22T21:30:00Z"
      },
      "4": {
        "name": "Character Development",
        "status": "pending"
      },
      "5": {
        "name": "World Constraints Extraction",
        "status": "pending"
      },
      "6": {
        "name": "Relationship Mapping",
        "status": "pending"
      },
      "7": {
        "name": "Relationship Architecture",
        "status": "pending"
      },
      "8": {
        "name": "Premise Refinement",
        "status": "pending"
      },
      "9": {
        "name": "Story Outline",
        "status": "pending"
      },
      "10": {
        "name": "NPE Inspection",
        "status": "pending"
      },
      "11": {
        "name": "Outline Rewrite",
        "status": "pending"
      }
    }
  }
}
