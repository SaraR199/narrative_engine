{
  "workflow_name": "Book Design Workflow",
  "version": "1.0.0",
  "description": "AI-assisted creative writing workflow executed within Claude Code using Task tool for subagent spawning",
  "steps": {
    "1": {
      "name": "NPE Extraction",
      "description": "Extract Narrative Physics Engine from existing outline to capture generic writing preferences. Uses NPE template as base and customizes for genre and outline patterns.",
      "prompt_template": "step1_npe_extraction.md",
      "agent_type": "npe-extractor",
      "model": "sonnet",
      "inputs": {
        "NPE_TEMPLATE": "templates/npe_template",
        "OUTLINE_CONTENT": "input/existing_outline.md"
      },
      "outputs": {
        "npe": "outputs/npe.md"
      },
      "depends_on": []
    },
    "2": {
      "name": "Dramatic Spine Extraction",
      "description": "Extract the high-level dramatic spine (1-3 primary tension axes, 0-2 secondary axes, dominant energy, emotional progression) from story, character, and world concepts. Supports dual-genre novels requiring multiple equally-weighted tension sources.",
      "prompt_template": "step2_dramatic_spine.md",
      "agent_type": "story-architect",
      "model": "sonnet",
      "inputs": {
        "STORY_CONCEPT": "input/story-concept.md",
        "CHARACTERS_CONCEPT": "input/characters-concept.md",
        "WORLD_CONCEPT": "input/world-concept.md",
        "NPE": "outputs/npe.md"
      },
      "outputs": {
        "dramatic_spine": "outputs/dramatic_spine.md"
      },
      "depends_on": ["1"]
    },
    "3": {
      "name": "Theme Extraction",
      "description": "Extract core thematic questions (not statements) that the story explores. Identifies ONE main theme question and max 2 secondary theme questions.",
      "prompt_template": "step3_theme_extraction.md",
      "agent_type": "story-architect",
      "model": "sonnet",
      "inputs": {
        "STORY_CONCEPT": "input/story-concept.md",
        "CHARACTERS_CONCEPT": "input/characters-concept.md",
        "WORLD_CONCEPT": "input/world-concept.md",
        "NPE": "outputs/npe.md",
        "DRAMATIC_SPINE": "outputs/dramatic_spine.md"
      },
      "outputs": {
        "themes": "outputs/themes.md"
      },
      "depends_on": ["1", "2"]
    },
    "4": {
      "name": "Character Development",
      "description": "Develop detailed character profiles from character concepts using the Main Character Template. Supports multiple characters - spawns parallel subagents for each character in input file.",
      "prompt_template": "step4_character_development.md",
      "agent_type": "character-architect",
      "model": "sonnet",
      "parallel_processing": true,
      "inputs": {
        "CHARACTER_CONCEPT": "input/character-concept.md",
        "MAIN_CHARACTER_TEMPLATE": "templates/main_character_template_v1.1.md",
        "NPE": "outputs/npe.md",
        "DRAMATIC_SPINE": "outputs/dramatic_spine.md",
        "THEMES": "outputs/themes.md"
      },
      "outputs": {
        "character_profiles": "outputs/character_*.md"
      },
      "output_pattern": "outputs/character_{CharacterName}.md",
      "depends_on": ["1", "2", "3"]
    },
    "5": {
      "name": "World Constraints Extraction",
      "description": "Extract functional world constraints that limit movement, choices, and possibilities. Not a travel guide—focuses on geography, culture, resources, power structures, and vibes parameters that force better plotting.",
      "prompt_template": "step5_world_constraints.md",
      "agent_type": "story-architect",
      "model": "sonnet",
      "inputs": {
        "WORLD_CONCEPT": "input/world-concept.md",
        "NPE": "outputs/npe.md",
        "DRAMATIC_SPINE": "outputs/dramatic_spine.md",
        "THEMES": "outputs/themes.md",
        "CHARACTER_PROFILES": "outputs/character_*.md"
      },
      "outputs": {
        "world_constraints": "outputs/world_constraints.md"
      },
      "depends_on": ["1", "2", "3", "4"]
    },
    "6": {
      "name": "Relationship Mapping",
      "description": "Identify and extract important relationships from concept files and character profiles. Filters to main/primary relationships that drive plot, character arcs, or themes. Generates relationship mapping for architecture step.",
      "prompt_template": "step6_relationship_mapping.md",
      "agent_type": "character-architect",
      "model": "sonnet",
      "inputs": {
        "STORY_CONCEPT": "input/story-concept.md",
        "CHARACTERS_CONCEPT": "input/characters-concept.md",
        "CHARACTER_PROFILES": "outputs/character_*.md",
        "NPE": "outputs/npe.md",
        "DRAMATIC_SPINE": "outputs/dramatic_spine.md",
        "THEMES": "outputs/themes.md"
      },
      "outputs": {
        "relationship_mapping": "outputs/relationship_mapping.md"
      },
      "depends_on": ["1", "2", "3", "4"]
    },
    "7": {
      "name": "Relationship Architecture",
      "description": "Define relationship architecture for key character pairings. Supports multiple relationships - spawns parallel subagents for each relationship in mapping. Creates specs for consistent, evolving interactions across three-act structure.",
      "prompt_template": "step7_relationship_architecture.md",
      "agent_type": "character-architect",
      "model": "sonnet",
      "parallel_processing": true,
      "inputs": {
        "RELATIONSHIP_MAPPING": "outputs/relationship_mapping.md",
        "CHARACTER_PROFILES": "outputs/character_*.md",
        "NPE": "outputs/npe.md",
        "DRAMATIC_SPINE": "outputs/dramatic_spine.md",
        "THEMES": "outputs/themes.md",
        "WORLD_CONSTRAINTS": "outputs/world_constraints.md"
      },
      "outputs": {
        "relationship_architectures": "outputs/relationship_*.md"
      },
      "output_pattern": "outputs/relationship_{CharacterA}_{CharacterB}.md",
      "depends_on": ["1", "2", "3", "4", "5", "6"]
    },
    "8": {
      "name": "Premise Refinement",
      "description": "Refine the original story premise to align with all established structural foundations (NPE, dramatic spine, themes, character arcs, world constraints, relationships). Reads ONLY story-concept.md from original inputs plus all workflow outputs. Creates focused premise grounded in constraints.",
      "prompt_template": "step8_premise_refinement.md",
      "agent_type": "story-architect",
      "model": "sonnet",
      "inputs": {
        "STORY_CONCEPT": "input/story-concept.md",
        "NPE": "outputs/npe.md",
        "DRAMATIC_SPINE": "outputs/dramatic_spine.md",
        "THEMES": "outputs/themes.md",
        "CHARACTER_PROFILES": "outputs/character_*.md",
        "WORLD_CONSTRAINTS": "outputs/world_constraints.md",
        "RELATIONSHIP_ARCHITECTURES": "outputs/relationship_*.md"
      },
      "outputs": {
        "refined_premise": "outputs/refined_premise.md"
      },
      "depends_on": ["1", "2", "3", "4", "5", "6", "7"]
    },
    "9": {
      "name": "Story Outline",
      "description": "Synthesize all workflow outputs into a complete 3-act story outline. Creates structured blueprint with turning points, character-driven causality, relationship dynamics, and scene-level mechanics. Does NOT read original concept files—only uses NPE and workflow-generated outputs.",
      "prompt_template": "step9_outline.md",
      "agent_type": "story-architect",
      "model": "sonnet",
      "inputs": {
        "NPE": "outputs/npe.md",
        "DRAMATIC_SPINE": "outputs/dramatic_spine.md",
        "THEMES": "outputs/themes.md",
        "CHARACTER_PROFILES": "outputs/character_*.md",
        "WORLD_CONSTRAINTS": "outputs/world_constraints.md",
        "RELATIONSHIP_ARCHITECTURES": "outputs/relationship_*.md",
        "REFINED_PREMISE": "outputs/refined_premise.md"
      },
      "outputs": {
        "outline": "outputs/outline.md"
      },
      "depends_on": ["1", "2", "3", "4", "5", "6", "7", "8"]
    },
    "10": {
      "name": "NPE Inspection",
      "description": "Perform rigorous quality assurance inspection of the generated outline against the NPE. Identifies violations, strengths, and provides prioritized recommendations for bringing outline into full NPE compliance.",
      "prompt_template": "step10_npe_inspection.md",
      "agent_type": "story-architect",
      "model": "sonnet",
      "inputs": {
        "NPE": "outputs/npe.md",
        "OUTLINE": "outputs/outline.md"
      },
      "outputs": {
        "npe_inspection_report": "outputs/npe_inspection_report.md"
      },
      "depends_on": ["1", "9"]
    },
    "11": {
      "name": "Outline Rewrite",
      "description": "Rewrite the outline to achieve full NPE compliance based on inspection report. Authorized to rebuild entire acts, restructure scenes from scratch, and make fundamental structural changes. Not a patch job—fluid reconstruction with focus on structural integrity over preservation.",
      "prompt_template": "step11_outline_rewrite.md",
      "agent_type": "story-architect",
      "model": "sonnet",
      "inputs": {
        "NPE": "outputs/npe.md",
        "INSPECTION_REPORT": "outputs/npe_inspection_report.md",
        "ORIGINAL_OUTLINE": "outputs/outline.md"
      },
      "outputs": {
        "outline_revised": "outputs/outline_revised.md"
      },
      "depends_on": ["1", "9", "10"]
    }
  },
  "usage": "Tell Claude Code: 'Run step 1 for [project-name]', 'Run step 2 for [project-name]', or 'Run the book design workflow for [project-name]'. Use '/create-project [project-name]' to create a new project.",
  "notes": {
    "orchestration": "Claude Code acts as the orchestrator, spawning subagents via Task tool",
    "multi_project": "All input/output paths are resolved relative to projects/{project-name}/ when a project name is specified",
    "context_minimal": "Each subagent only loads files specified in 'inputs' and 'depends_on'",
    "parallel_processing": "Steps with parallel_processing:true will parse input files and spawn multiple subagents in parallel (e.g., Step 2 spawns one agent per character)",
    "adding_steps": "Add new step objects with incremental numbering",
    "model_options": "sonnet (default, balanced), opus (most capable), haiku (fastest)"
  }
}
